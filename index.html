<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä½œæ›²å®¶ Ã— è¡€æ¶²å‹ å ã„ã€ç©¶æ¥µç‰ˆã€‘</title>
    
    <!-- â–¼â–¼â–¼ å¤–éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼ˆChart.js, html2canvasï¼‰ â–¼â–¼â–¼ -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

    <!-- â–¼â–¼â–¼ CSSï¼ˆãƒ‡ã‚¶ã‚¤ãƒ³ï¼‰ â–¼â–¼â–¼ -->
    <style>
        :root {
            --primary-color: #333;
            --secondary-color: #f4f4f4;
            --accent-color: #c59b6d;
            --card-bg-color: #ffffff;
            --shadow-color: rgba(0,0,0,0.1);
            --locked-color: #ccc;
        }

        body {
            font-family: 'Hiragino Kaku Gothic ProN', 'Meiryo', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--secondary-color);
            color: var(--primary-color);
            line-height: 1.7;
        }

        .container { max-width: 700px; margin: 0 auto; padding: 20px; }

        header { text-align: center; padding: 20px 0; border-bottom: 2px solid var(--accent-color); }
        header h1 { margin: 0; color: var(--accent-color); font-size: 2.2rem; font-weight: normal; }
        header p { margin-top: 5px; font-size: 1.1rem; color: #666; }

        main { padding: 30px 0; }
        
        /* æ—¥æ›¿ã‚ã‚Šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ */
        #daily-message {
            display: none;
            background-color: #fffaf0;
            border: 1px solid var(--accent-color);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 30px;
            text-align: center;
            font-size: 1.1rem;
            color: #8c6d4e;
        }

        .card {
            background-color: var(--card-bg-color);
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 15px var(--shadow-color);
            margin-bottom: 30px;
        }

        #input-section { text-align: center; }
        #input-section h2 { margin-top: 0; margin-bottom: 20px; font-weight: 500; }
        .selector-group { display: flex; justify-content: center; align-items: center; gap: 20px; margin-bottom: 30px; }
        .selector-group select { padding: 12px 15px; font-size: 1rem; border: 1px solid #ccc; border-radius: 8px; cursor: pointer; min-width: 150px; }

        .btn {
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.2rem;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
        }
        .btn-primary { background-color: var(--accent-color); }
        .btn-primary:hover { background-color: #b3895e; transform: translateY(-2px); }
        .btn-secondary { background-color: #888; font-size: 1rem; padding: 10px 25px; margin-top: 20px; }
        .btn-secondary:hover { background-color: #666; }


        #result-section { display: none; animation: fadeIn 0.8s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .result-header { display: flex; align-items: center; gap: 20px; border-bottom: 1px solid #eee; padding-bottom: 20px; margin-bottom: 20px; }
        #result-image { width: 100px; height: 100px; border-radius: 50%; object-fit: cover; border: 3px solid var(--accent-color); }
        #result-title { margin: 0; font-size: 1.8rem; font-weight: 500; }
        .result-content h3 { color: var(--accent-color); margin-top: 25px; margin-bottom: 10px; border-left: 4px solid var(--accent-color); padding-left: 10px; font-size: 1.2rem; }
        .result-content a { color: var(--accent-color); text-decoration: none; font-weight: bold; }
        .result-content a:hover { text-decoration: underline; }
        .search-link-text { font-size: 0.9rem; color: #777; margin-top: 5px; }

        /* å±¥æ­´ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
        #history-section { text-align: center; }
        #history-grid { display: none; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-top: 20px; }
        .history-card { border: 1px solid #eee; border-radius: 8px; padding: 10px; }
        .history-card img { width: 60px; height: 60px; border-radius: 50%; object-fit: cover; }
        .history-card.locked img { filter: grayscale(1); opacity: 0.6; }
        .history-card p { margin: 5px 0 0; font-weight: bold; }
        .history-card.locked p { color: var(--locked-color); }
        .history-card .unlocked-types { font-size: 0.8rem; color: #888; }
        #completion-message { display: none; margin-top: 20px; padding: 15px; background: linear-gradient(135deg, #fffaf0, #fff); border: 2px solid var(--accent-color); border-radius: 8px; }

        footer { text-align: center; padding: 20px 0; margin-top: 30px; color: #888; font-size: 0.9rem; }
        
        @media (max-width: 600px) {
            header h1 { font-size: 1.8rem; }
            .card, #input-section { padding: 20px; }
            .selector-group { flex-direction: column; gap: 15px; }
            .result-header { flex-direction: column; text-align: center; }
            #history-grid { grid-template-columns: repeat(2, 1fr); }
        }
    </style>
</head>
<body>

    <div class="container">
        <header>
            <h1>ä½œæ›²å®¶ Ã— è¡€æ¶²å‹ å ã„</h1>
            <p>ã‚ãªãŸã®ä¸­ã«çœ ã‚‹éŸ³æ¥½å®¶ã®é­‚ã‚’è¨ºæ–­ã—ã¾ã™</p>
        </header>

        <main>
            <div id="daily-message"></div>

            <section id="input-section" class="card">
                <h2>æƒ¹ã‹ã‚Œã‚‹ä½œæ›²å®¶ã¨ã‚ãªãŸã®è¡€æ¶²å‹ã‚’é¸æŠã—ã¦ãã ã•ã„</h2>
                <div class="selector-group">
                    <select id="composer-select" aria-label="ä½œæ›²å®¶ã‚’é¸æŠ">
                        <option value="mozart">ãƒ¢ãƒ¼ãƒ„ã‚¡ãƒ«ãƒˆ</option>
                        <option value="beethoven">ãƒ™ãƒ¼ãƒˆãƒ¼ãƒ´ã‚§ãƒ³</option>
                        <option value="chopin">ã‚·ãƒ§ãƒ‘ãƒ³</option>
                        <option value="bach">ãƒãƒƒãƒ</option>
                    </select>
                    <select id="blood-select" aria-label="è¡€æ¶²å‹ã‚’é¸æŠ">
                        <option value="a">Aå‹</option>
                        <option value="b">Bå‹</option>
                        <option value="o">Oå‹</option>
                        <option value="ab">ABå‹</option>
                    </select>
                </div>
                <button id="uranai-button" class="btn btn-primary">è¨ºæ–­ã™ã‚‹</button>
            </section>

            <section id="result-section" class="card">
                <div class="result-header">
                    <img id="result-image" src="" alt="ä½œæ›²å®¶ã®è‚–åƒ">
                    <div>
                        <p style="margin:0;font-size:1.1rem;">ã‚ãªãŸã®ã‚¿ã‚¤ãƒ—ã¯...</p>
                        <h2 id="result-title"></h2>
                    </div>
                </div>
                <div class="result-content">
                    <h3>ã‚ãªãŸã®æœ¬è³ªã¨ä»Šæ—¥ã®é‹å‹¢</h3>
                    <p id="result-text"></p>
                    <h3>ä»Šæ—¥ã®é‹å‹¢ã‚°ãƒ©ãƒ•</h3>
                    <canvas id="result-chart"></canvas>
                    <h3>ãƒ©ãƒƒã‚­ãƒ¼ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</h3>
                    <p id="result-action"></p>
                    <h3>ä»Šæ—¥ã®ãƒ©ãƒƒã‚­ãƒ¼ãƒŸãƒ¥ãƒ¼ã‚¸ãƒƒã‚¯</h3>
                    <p id="result-music"></p>
                    <p id="result-search-link" class="search-link-text"></p>
                    <h3>ä½œæ›²å®¶ã®è±†çŸ¥è­˜</h3>
                    <p id="result-quote"></p>

                    <div style="text-align:center;">
                        <button id="share-button" class="btn btn-secondary">çµæœã‚’ç”»åƒã§ä¿å­˜</button>
                    </div>
                </div>
            </section>
            
            <section id="history-section" class="card">
                <h2>è¨ºæ–­ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³æ‰‹å¸³</h2>
                <button id="history-toggle-button" class="btn btn-secondary">æ‰‹å¸³ã‚’è¦‹ã‚‹</button>
                <div id="history-grid"></div>
                <div id="completion-message">
                    <h3>ğŸ‰ å…¨ã‚¿ã‚¤ãƒ— ã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆï¼ ğŸ‰</h3>
                    <p>ã‚ãªãŸã¯çœŸã®ã‚¯ãƒ©ã‚·ãƒƒã‚¯éŸ³æ¥½ãƒã‚¹ã‚¿ãƒ¼ã§ã™ï¼ç´ æ™´ã‚‰ã—ã„æ¢æ±‚å¿ƒã«æ‹æ‰‹ï¼</p>
                </div>
            </section>
        </main>
        
        <footer>
            <p>Â© 2023 ä½œæ›²å®¶å ã„ã€ç©¶æ¥µç‰ˆã€‘</p>
        </footer>
    </div>


    <!-- â–¼â–¼â–¼ JavaScriptï¼ˆã‚¢ãƒ—ãƒªã®å‹•ä½œï¼‰ â–¼â–¼â–¼ -->
    <script>
        // --- ãƒ‡ãƒ¼ã‚¿å®šç¾© ---
        const composerInfo = {
            mozart: { name: "ãƒ¢ãƒ¼ãƒ„ã‚¡ãƒ«ãƒˆ", image: "images/2098732.jpg", quote: "æ‰‹ç´™ã§ä¸‹å“ãªã‚¸ãƒ§ãƒ¼ã‚¯ã‚’é€£ç™ºã™ã‚‹ãªã©ã€å¤©çœŸçˆ›æ¼«ãªä¸€é¢ã‚‚ã€‚ãã®ç´”ç²‹ã•ãŒã€ç¥ã‹ã‚‰ä¸ãˆã‚‰ã‚ŒãŸã‚ˆã†ãªéŸ³æ¥½ã‚’ç”Ÿã¿å‡ºã—ãŸã®ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚" },
            beethoven: { name: "ãƒ™ãƒ¼ãƒˆãƒ¼ãƒ´ã‚§ãƒ³", image: "images/2067071.jpg", quote: "ã€Œè‹¦æ‚©ã‚’çªãæŠœã‘ã¦æ­“å–œã¸ã€ã¨ã„ã†è¨€è‘‰ã‚’æ®‹ã—ãŸå½¼ã¯ã€æ•°ã€…ã®å›°é›£ã¨é—˜ã„ãªãŒã‚‰ã€äººé¡ã®å®ã¨ãªã‚‹å‚‘ä½œã‚’ç”Ÿã¿å‡ºã—ç¶šã‘ã¾ã—ãŸã€‚" },
            chopin: { name: "ã‚·ãƒ§ãƒ‘ãƒ³", image: "images/2176775.jpg", quote: "ã€Œãƒ”ã‚¢ãƒã®è©©äººã€ã¨å‘¼ã°ã‚Œã€ç”Ÿæ¶¯ã®ã»ã¨ã‚“ã©ã‚’ä½œæ›²ã¨ãƒ”ã‚¢ãƒæ¼”å¥ã«æ§ã’ã¾ã—ãŸã€‚å¿ƒã«ã¯ç¥–å›½ãƒãƒ¼ãƒ©ãƒ³ãƒ‰ã¸ã®ç†±ã„æ€ã„ã‚’ç§˜ã‚ã¦ã„ã¾ã—ãŸã€‚" },
            bach: { name: "ãƒãƒƒãƒ", image: "images/2098728.jpg", quote: "ã€ŒéŸ³æ¥½ã®çˆ¶ã€ã¨ç§°ã•ã‚Œã‚‹å¤§ãƒãƒƒãƒã€‚ç”Ÿæ¶¯ã§1000æ›²ä»¥ä¸Šã‚’ä½œæ›²ã—ã€20äººã®å­ä¾›ã‚’ã‚‚ã†ã‘ãŸã€å…¬ç§ã¨ã‚‚ã«ãƒ‘ãƒ¯ãƒ•ãƒ«ã§å‰å¤§ãªäººç‰©ã§ã—ãŸã€‚" }
        };

        const fortuneData = {
            mozart: {
                a: { text: "å‡ å¸³é¢ãªå¤©æ‰...", action: "3ã¤ã®ã‚¸ãƒ£ãƒ³ãƒ«ã®éŸ³æ¥½ã‚’è´ã", musicTitle: "ãƒˆãƒ«ã‚³è¡Œé€²æ›²", youtubeId: "p0-U20-S_J8", youtubeSearch: "ãƒ¢ãƒ¼ãƒ„ã‚¡ãƒ«ãƒˆ+ãƒˆãƒ«ã‚³è¡Œé€²æ›²", scores: { "å‰µé€ æ€§": 5, "è¨ˆç”»æ€§": 5, "å¯¾äººé‹": 3, "è¡Œå‹•åŠ›": 3, "é›†ä¸­åŠ›": 4 } },
                b: { text: "ç©¶æ¥µã®è‡ªç”±äºº...", action: "æ™®æ®µé€šã‚‰ãªã„é“ã‚’æ•£æ­©", musicTitle: "ã‚¢ã‚¤ãƒãƒ»ã‚¯ãƒ©ã‚¤ãƒãƒ»ãƒŠãƒãƒˆãƒ ã‚¸ãƒ¼ã‚¯", youtubeId: "Qb_jQBgzU-I", youtubeSearch: "ãƒ¢ãƒ¼ãƒ„ã‚¡ãƒ«ãƒˆ+ã‚¢ã‚¤ãƒã‚¯ãƒ©ã‚¤ãƒ", scores: { "å‰µé€ æ€§": 5, "è¨ˆç”»æ€§": 1, "å¯¾äººé‹": 5, "è¡Œå‹•åŠ›": 5, "é›†ä¸­åŠ›": 2 } },
                o: { text: "çš†ã‚’ç…§ã‚‰ã™å¤ªé™½ã®ã‚ˆã†ãªå¤©æ‰...", action: "èª°ã‹ã«ãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆã‚’ã™ã‚‹", musicTitle: "æ­ŒåŠ‡ã€ãƒ•ã‚£ã‚¬ãƒ­ã®çµå©šã€åºæ›²", youtubeId: "blgfb75iG2U", youtubeSearch: "ãƒ¢ãƒ¼ãƒ„ã‚¡ãƒ«ãƒˆ+ãƒ•ã‚£ã‚¬ãƒ­ã®çµå©š", scores: { "å‰µé€ æ€§": 4, "è¨ˆç”»æ€§": 3, "å¯¾äººé‹": 5, "è¡Œå‹•åŠ›": 4, "é›†ä¸­åŠ›": 3 } },
                ab: { text: "ã‚¯ãƒ¼ãƒ«ãªè¦³å¯Ÿè€…...", action: "ç¾è¡“é¤¨ã‚’è¨ªã‚Œã‚‹", musicTitle: "ãƒ¬ã‚¯ã‚¤ã‚¨ãƒ ", youtubeId: "sPlhKP0nZII", youtubeSearch: "ãƒ¢ãƒ¼ãƒ„ã‚¡ãƒ«ãƒˆ+ãƒ¬ã‚¯ã‚¤ã‚¨ãƒ ", scores: { "å‰µé€ æ€§": 4, "è¨ˆç”»æ€§": 4, "å¯¾äººé‹": 2, "è¡Œå‹•åŠ›": 2, "é›†ä¸­åŠ›": 5 } }
            },
            beethoven: {
                a: { text: "å†…ã«æƒ…ç†±ã‚’ç§˜ã‚ãŸåŠªåŠ›å®¶...", action: "éƒ¨å±‹ã®æ•´ç†æ•´é “", musicTitle: "ãƒ”ã‚¢ãƒã‚½ãƒŠã‚¿ã€æœˆå…‰ã€", youtubeId: "4Tr0otuiQuU", youtubeSearch: "ãƒ™ãƒ¼ãƒˆãƒ¼ãƒ´ã‚§ãƒ³+æœˆå…‰", scores: { "å‰µé€ æ€§": 3, "è¨ˆç”»æ€§": 5, "å¯¾äººé‹": 3, "è¡Œå‹•åŠ›": 3, "é›†ä¸­åŠ›": 5 } },
                b: { text: "é­‚ã®é©å‘½å®¶...", action: "è‡ªåˆ†ã®æ„è¦‹ã‚’åŠ›å¼·ãä¸»å¼µ", musicTitle: "äº¤éŸ¿æ›²ç¬¬5ç•ªã€é‹å‘½ã€", youtubeId: "jv2WJMVPQi8", youtubeSearch: "ãƒ™ãƒ¼ãƒˆãƒ¼ãƒ´ã‚§ãƒ³+é‹å‘½", scores: { "å‰µé€ æ€§": 5, "è¨ˆç”»æ€§": 2, "å¯¾äººé‹": 4, "è¡Œå‹•åŠ›": 5, "é›†ä¸­åŠ›": 3 } },
                o: { text: "é ¼ã‚Œã‚‹æƒ…ç†±å®¶...", action: "å‹äººã¨ç†±ãèªã‚Šåˆã†", musicTitle: "äº¤éŸ¿æ›²ç¬¬9ç•ªã€åˆå”±ä»˜ãã€", youtubeId: "t3217H8JppI", youtubeSearch: "ãƒ™ãƒ¼ãƒˆãƒ¼ãƒ´ã‚§ãƒ³+ç¬¬ä¹", scores: { "å‰µé€ æ€§": 4, "è¨ˆç”»æ€§": 3, "å¯¾äººé‹": 5, "è¡Œå‹•åŠ›": 5, "é›†ä¸­åŠ›": 3 } },
                ab: { text: "å­¤é«˜ã®æ¢æ±‚è€…...", action: "æ—¥è¨˜ã«è‡ªåˆ†ã®è€ƒãˆã‚’æ›¸ã", musicTitle: "ãƒ”ã‚¢ãƒã‚½ãƒŠã‚¿ã€æ‚²æ„´ã€", youtubeId: "qqeC9b8d-yE", youtubeSearch: "ãƒ™ãƒ¼ãƒˆãƒ¼ãƒ´ã‚§ãƒ³+æ‚²æ„´", scores: { "å‰µé€ æ€§": 4, "è¨ˆç”»æ€§": 4, "å¯¾äººé‹": 2, "è¡Œå‹•åŠ›": 1, "é›†ä¸­åŠ›": 5 } }
            },
            chopin: {
                a: { text: "ç¹Šç´°ãªå¹³å’Œä¸»ç¾©è€…...", action: "ãŠæ°—ã«å…¥ã‚Šã®é¦™ã‚Šã®ã‚¯ãƒªãƒ¼ãƒ ã‚’ä½¿ã†", musicTitle: "ãƒã‚¯ã‚¿ãƒ¼ãƒ³ç¬¬2ç•ª", youtubeId: "9E6b3swbnWg", youtubeSearch: "ã‚·ãƒ§ãƒ‘ãƒ³+ãƒã‚¯ã‚¿ãƒ¼ãƒ³", scores: { "å‰µé€ æ€§": 4, "è¨ˆç”»æ€§": 4, "å¯¾äººé‹": 4, "è¡Œå‹•åŠ›": 2, "é›†ä¸­åŠ›": 4 } },
                b: { text: "æ°—ã¾ãã‚Œãªãƒ­ãƒãƒ³ãƒã‚¹ãƒˆ...", action: "èŠ±ã‚’é£¾ã‚‹ã€ã¾ãŸã¯èŠ±å±‹ã‚’ã®ãã", musicTitle: "å¹»æƒ³å³èˆˆæ›²", youtubeId: "Gus4dn_K-3I", youtubeSearch: "ã‚·ãƒ§ãƒ‘ãƒ³+å¹»æƒ³å³èˆˆæ›²", scores: { "å‰µé€ æ€§": 5, "è¨ˆç”»æ€§": 1, "å¯¾äººé‹": 4, "è¡Œå‹•åŠ›": 4, "é›†ä¸­åŠ›": 2 } },
                o: { text: "è¦ªã—ã¿ã‚„ã™ã„è©©äºº...", action: "ã‚«ãƒ•ã‚§ã§äººé–“è¦³å¯Ÿ", musicTitle: "è‹±é›„ãƒãƒ­ãƒãƒ¼ã‚º", youtubeId: "fW0Y3M4EJ4M", youtubeSearch: "ã‚·ãƒ§ãƒ‘ãƒ³+è‹±é›„ãƒãƒ­ãƒãƒ¼ã‚º", scores: { "å‰µé€ æ€§": 4, "è¨ˆç”»æ€§": 3, "å¯¾äººé‹": 5, "è¡Œå‹•åŠ›": 4, "é›†ä¸­åŠ›": 3 } },
                ab: { text: "å¤¢è¦‹ã‚‹ãƒªã‚¢ãƒªã‚¹ãƒˆ...", action: "è©©é›†ã‚„ç¾ã—ã„å†™çœŸé›†ã‚’çœºã‚ã‚‹", musicTitle: "åˆ¥ã‚Œã®æ›²", youtubeId: "ifKK0_iZ_bI", youtubeSearch: "ã‚·ãƒ§ãƒ‘ãƒ³+åˆ¥ã‚Œã®æ›²", scores: { "å‰µé€ æ€§": 5, "è¨ˆç”»æ€§": 3, "å¯¾äººé‹": 2, "è¡Œå‹•åŠ›": 1, "é›†ä¸­åŠ›": 5 } }
            },
            bach: {
                a: { text: "å‰å¤§ãªã‚‹æ§‹æˆä½œå®¶...", action: "ä¸€æ—¥ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ç´°ã‹ãç«‹ã¦ã‚‹", musicTitle: "Gç·šä¸Šã®ã‚¢ãƒªã‚¢", youtubeId: "GMkmQlfOgeE", youtubeSearch: "ãƒãƒƒãƒ+Gç·šä¸Šã®ã‚¢ãƒªã‚¢", scores: { "å‰µé€ æ€§": 3, "è¨ˆç”»æ€§": 5, "å¯¾äººé‹": 3, "è¡Œå‹•åŠ›": 3, "é›†ä¸­åŠ›": 5 } },
                b: { text: "ç‹¬å‰µçš„ãªè·äºº...", action: "ã„ã¤ã‚‚ä½¿ã†ã‚‚ã®ã«ã‚¢ãƒ¬ãƒ³ã‚¸ã‚’åŠ ãˆã‚‹", musicTitle: "ãƒˆãƒƒã‚«ãƒ¼ã‚¿ã¨ãƒ•ãƒ¼ã‚¬ ãƒ‹çŸ­èª¿", youtubeId: "ho9rZjlsyYY", youtubeSearch: "ãƒãƒƒãƒ+ãƒˆãƒƒã‚«ãƒ¼ã‚¿ã¨ãƒ•ãƒ¼ã‚¬", scores: { "å‰µé€ æ€§": 5, "è¨ˆç”»æ€§": 3, "å¯¾äººé‹": 3, "è¡Œå‹•åŠ›": 4, "é›†ä¸­åŠ›": 4 } },
                o: { text: "çš†ã®çˆ¶ãªã‚‹å­˜åœ¨...", action: "æ‰‹æ–™ç†ã‚’èª°ã‹ã«æŒ¯ã‚‹èˆã†", musicTitle: "ä¸»ã‚ˆã€äººã®æœ›ã¿ã®å–œã³ã‚ˆ", youtubeId: "Fw_5I1aLg_0", youtubeSearch: "ãƒãƒƒãƒ+ä¸»ã‚ˆäººã®æœ›ã¿ã®å–œã³ã‚ˆ", scores: { "å‰µé€ æ€§": 3, "è¨ˆç”»æ€§": 4, "å¯¾äººé‹": 5, "è¡Œå‹•åŠ›": 4, "é›†ä¸­åŠ›": 4 } },
                ab: { text: "ç¥ã«æ„›ã•ã‚ŒãŸå»ºç¯‰å®¶...", action: "ãƒ‘ã‚ºãƒ«ã‚„ãƒœãƒ¼ãƒ‰ã‚²ãƒ¼ãƒ ã«æŒ‘æˆ¦", musicTitle: "ç„¡ä¼´å¥ãƒã‚§ãƒ­çµ„æ›²ç¬¬1ç•ª", youtubeId: "1prweT95Mo0", youtubeSearch: "ãƒãƒƒãƒ+ç„¡ä¼´å¥ãƒã‚§ãƒ­çµ„æ›²", scores: { "å‰µé€ æ€§": 5, "è¨ˆç”»æ€§": 5, "å¯¾äººé‹": 1, "è¡Œå‹•åŠ›": 2, "é›†ä¸­åŠ›": 5 } }
            }
        };

        // --- ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•° ---
        let myChart;
        let diagnosisHistory = {};

        // --- DOMè¦ç´ ã®å–å¾— ---
        const dailyMessageEl = document.getElementById('daily-message');
        const uranaiButton = document.getElementById('uranai-button');
        const resultSection = document.getElementById('result-section');
        const shareButton = document.getElementById('share-button');
        const historyToggleButton = document.getElementById('history-toggle-button');
        const historyGrid = document.getElementById('history-grid');
        const completionMessage = document.getElementById('completion-message');
        
        // --- ãƒšãƒ¼ã‚¸ã®åˆæœŸåŒ–å‡¦ç† ---
        document.addEventListener('DOMContentLoaded', () => {
            checkDailyMessage();
            loadHistory();
            renderHistory();

            // --- ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š ---
            uranaiButton.addEventListener('click', doUranai);
            shareButton.addEventListener('click', downloadResultImage);
            historyToggleButton.addEventListener('click', toggleHistoryView);
        });

        // --- æ©Ÿèƒ½åˆ¥ãƒ•ã‚¡ãƒ³ã‚¯ã‚·ãƒ§ãƒ³ ---

        /** å ã„å®Ÿè¡Œ */
        function doUranai() {
            const composerSelect = document.getElementById('composer-select');
            const bloodSelect = document.getElementById('blood-select');
            const composer = composerSelect.value;
            const blood = bloodSelect.value;
            const bloodTypeText = bloodSelect.options[bloodSelect.selectedIndex].text;

            const info = composerInfo[composer];
            const fortune = fortuneData[composer][blood];

            // çµæœè¡¨ç¤º
            displayResults(info, fortune, bloodTypeText);
            renderRadarChart(fortune.scores);
            
            // å±¥æ­´æ›´æ–°
            saveHistory(composer, blood);
            renderHistory();
            checkCompletion();

            resultSection.style.display = 'block';
            resultSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        /** çµæœã‚’ç”»é¢ã«è¡¨ç¤º */
        function displayResults(info, fortune, bloodTypeText) {
            document.getElementById('result-image').src = info.image;
            document.getElementById('result-image').alt = info.name;
            document.getElementById('result-title').textContent = `${info.name} (${bloodTypeText})`;
            document.getElementById('result-text').textContent = fortune.text;
            document.getElementById('result-action').textContent = fortune.action;
            document.getElementById('result-quote').textContent = info.quote;

            const musicEl = document.getElementById('result-music');
            musicEl.innerHTML = `<a href="https://www.youtube.com/watch?v=${fortune.youtubeId}" target="_blank" rel="noopener noreferrer">${fortune.musicTitle}</a> ã‚’è´ãã¨é‹æ°—ã‚¢ãƒƒãƒ—ã€‚`;
            
            const searchLinkEl = document.getElementById('result-search-link');
            const searchUrl = `https://www.youtube.com/results?search_query=${fortune.youtubeSearch}`;
            searchLinkEl.innerHTML = `(ãƒªãƒ³ã‚¯ãŒè¦‹ã‚‰ã‚Œãªã„å ´åˆã¯ã€<a href="${searchUrl}" target="_blank" rel="noopener noreferrer">ã“ã¡ã‚‰ã‹ã‚‰æ¤œç´¢</a>)`;
        }

        /** ãƒ¬ãƒ¼ãƒ€ãƒ¼ãƒãƒ£ãƒ¼ãƒˆæç”» */
        function renderRadarChart(scores) {
            const ctx = document.getElementById('result-chart').getContext('2d');
            if (myChart) {
                myChart.destroy(); // æ—¢å­˜ã®ãƒãƒ£ãƒ¼ãƒˆãŒã‚ã‚Œã°ç ´æ£„
            }
            myChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: Object.keys(scores),
                    datasets: [{
                        label: 'ä»Šæ—¥ã®é‹å‹¢',
                        data: Object.values(scores),
                        backgroundColor: 'rgba(197, 155, 109, 0.2)',
                        borderColor: 'rgba(197, 155, 109, 1)',
                        borderWidth: 2
                    }]
                },
                options: {
                    scales: {
                        r: {
                            angleLines: { color: '#ddd' },
                            grid: { color: '#eee' },
                            pointLabels: { font: { size: 14 }, color: '#555' },
                            suggestedMin: 0,
                            suggestedMax: 5,
                            ticks: { stepSize: 1 }
                        }
                    },
                    plugins: { legend: { display: false } }
                }
            });
        }
        
        /** çµæœã‚’ç”»åƒã¨ã—ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ */
        function downloadResultImage() {
            const target = document.getElementById('result-section');
            const button = document.getElementById('share-button');
            const originalText = button.textContent;
            button.textContent = 'ç”»åƒç”Ÿæˆä¸­...';
            button.disabled = true;

            html2canvas(target, { 
                backgroundColor: getComputedStyle(document.body).backgroundColor, // èƒŒæ™¯è‰²ã‚’ã‚­ãƒ£ãƒ—ãƒãƒ£
                onclone: (doc) => { // ã‚¯ãƒ­ãƒ¼ãƒ³ã•ã‚ŒãŸDOMã§ã‚¹ã‚¿ã‚¤ãƒ«èª¿æ•´
                    const clonedResult = doc.getElementById('result-section');
                    clonedResult.style.animation = 'none'; // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç„¡åŠ¹åŒ–
                    clonedResult.style.boxShadow = 'none'; // å½±ã‚’ç„¡åŠ¹åŒ–
                }
            }).then(canvas => {
                const link = document.createElement('a');
                link.download = 'composer-fortune.png';
                link.href = canvas.toDataURL('image/png');
                link.click();
                button.textContent = originalText;
                button.disabled = false;
            });
        }

        /** å±¥æ­´ã‚’èª­ã¿è¾¼ã‚€ */
        function loadHistory() {
            const savedHistory = localStorage.getItem('composerFortuneHistory');
            if (savedHistory) {
                diagnosisHistory = JSON.parse(savedHistory);
            }
        }

        /** å±¥æ­´ã‚’ä¿å­˜ã™ã‚‹ */
        function saveHistory(composer, blood) {
            if (!diagnosisHistory[composer]) {
                diagnosisHistory[composer] = [];
            }
            if (!diagnosisHistory[composer].includes(blood)) {
                diagnosisHistory[composer].push(blood);
            }
            localStorage.setItem('composerFortuneHistory', JSON.stringify(diagnosisHistory));
        }

        /** å±¥æ­´æ‰‹å¸³ã‚’æç”»ã™ã‚‹ */
        function renderHistory() {
            historyGrid.innerHTML = '';
            Object.keys(composerInfo).forEach(composerKey => {
                const info = composerInfo[composerKey];
                const unlocked = diagnosisHistory[composerKey] || [];
                
                const card = document.createElement('div');
                card.className = 'history-card';
                if (unlocked.length === 0) {
                    card.classList.add('locked');
                }
                
                let bloodTypesHtml = ['a', 'b', 'o', 'ab'].map(b => 
                    `<span style="color:${unlocked.includes(b) ? 'var(--accent-color)' : 'var(--locked-color)'};">${b.toUpperCase()}</span>`
                ).join(' ');

                card.innerHTML = `
                    <img src="${info.image}" alt="${info.name}">
                    <p>${info.name}</p>
                    <div class="unlocked-types">${bloodTypesHtml}</div>
                `;
                historyGrid.appendChild(card);
            });
        }
        
        /** æ‰‹å¸³ã®è¡¨ç¤º/éè¡¨ç¤ºã‚’åˆ‡ã‚Šæ›¿ãˆ */
        function toggleHistoryView() {
            if (historyGrid.style.display === 'grid') {
                historyGrid.style.display = 'none';
                historyToggleButton.textContent = 'æ‰‹å¸³ã‚’è¦‹ã‚‹';
            } else {
                historyGrid.style.display = 'grid';
                historyToggleButton.textContent = 'æ‰‹å¸³ã‚’é–‰ã˜ã‚‹';
            }
        }
        
        /** å…¨ã‚¿ã‚¤ãƒ—ã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆã‚’ãƒã‚§ãƒƒã‚¯ */
        function checkCompletion() {
            let count = 0;
            Object.values(diagnosisHistory).forEach(arr => {
                count += arr.length;
            });
            if (count === 16) {
                completionMessage.style.display = 'block';
            }
        }
        
        /** æ—¥æ›¿ã‚ã‚Šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ãƒã‚§ãƒƒã‚¯ */
        function checkDailyMessage() {
            const today = new Date();
            const month = today.getMonth() + 1;
            const day = today.getDate();
            let message = '';

            if (month === 1 && day === 27) message = 'ä»Šæ—¥ã¯ãƒ¢ãƒ¼ãƒ„ã‚¡ãƒ«ãƒˆã®èª•ç”Ÿæ—¥ï¼å¤©æ‰çš„ãªé–ƒããŒã‚ã‚‹ã‹ã‚‚ï¼Ÿ';
            else if (month === 3 && day === 1) message = 'ä»Šæ—¥ã¯ã‚·ãƒ§ãƒ‘ãƒ³ã®èª•ç”Ÿæ—¥ï¼è©©çš„ãªä¸€æ—¥ã‚’éã”ã›ãã†ã€‚';
            else if (month === 3 && day === 31) message = 'ä»Šæ—¥ã¯J.S.ãƒãƒƒãƒã®èª•ç”Ÿæ—¥ï¼è¨ˆç”»ãŒã¯ã‹ã©ã‚‹ä¸€æ—¥ã«ãªã‚Šãã†ã€‚';
            else if (month === 12 && day === 17) message = 'ä»Šæ—¥ã¯ãƒ™ãƒ¼ãƒˆãƒ¼ãƒ´ã‚§ãƒ³ã®èª•ç”Ÿæ—¥ï¼æƒ…ç†±çš„ã«éã”ã—ã¾ã—ã‚‡ã†ï¼';

            if (message) {
                dailyMessageEl.textContent = `âœ¨ ${message} âœ¨`;
                dailyMessageEl.style.display = 'block';
            }
        }
    </script>
</body>
</html>